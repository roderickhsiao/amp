<!doctype html>
<html lang="en">
  <head>
    <script type="text/javascript">
      var parseQueryString = function parse(queryString) {
        if (!queryString) {
          return {};
        }
        var params = {};
        var queries = [];
        queries = queryString.split('&amp;');
        queries.forEach(function eachQuery(query, i) {
          var pair = query.split('=');
          params[pair[0]] = pair[1];
        });
        return params;
      }
      window.addEventListener('message', function listenerCallback(event) {
        if (event.data.sentinel !== 'branch-amp') {
          return;
        }
        window.parent.location = 'https://branch.io';
      }, false);

      var search = window.location.search || '';
      var queryString = queryString.substr(1);
      var queryObject = parseQueryString(queryString);

      window.onload = function windowOnload() {
        var parent = window.parent;
        parent.postMessage({
          sentinel: 'branch-amp',
          redirect: parent.location.hostname + parent.location.pathname + search
        }, '*');
      };
    </script>
    <style>
      #l { width: 1px; height: 1px; visibility: hidden; border: none; position: fixed; bottom: 0; }
      html { visibility: none; }
    </style>
  </head>
  <body>
    <iframe id="l"/>
  </body>
</html>
